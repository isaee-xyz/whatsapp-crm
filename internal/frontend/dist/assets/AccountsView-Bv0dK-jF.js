import{d as Q,r as k,x as Y,H as C,K as f,c as _,h as s,k as x,a as o,w as n,g as Z,b as t,i,l as y,v as p,F as ee,s as se,n as te,I as B,S as L,o as d}from"./index-CYNh7eqI.js";import{a as D,_ as I}from"./CardContent.vue_vue_type_script_setup_true_lang-BVSlREZs.js";import{_ as m}from"./Button.vue_vue_type_script_setup_true_lang-CdpToHaS.js";import{_ as h}from"./Input.vue_vue_type_script_setup_true_lang-c8YZDCZO.js";import{_ as c}from"./Label.vue_vue_type_script_setup_true_lang-BiSM-I6O.js";import{_ as U}from"./Badge.vue_vue_type_script_setup_true_lang-lXziiQoX.js";import{_ as oe}from"./ScrollArea.vue_vue_type_script_setup_true_lang-BYu-HJVo.js";import{_ as W}from"./Separator.vue_vue_type_script_setup_true_lang-D6eY7m55.js";import{_ as ae,X as ne,a as le,b as ie,c as re,d as de,e as ue}from"./DialogFooter.vue_vue_type_script_setup_true_lang-BYVwNXX_.js";import{L as T}from"./loader-2-D9Xdgoi3.js";import{A as pe}from"./arrow-left-DE60ug_1.js";import{P as E,a as fe,T as me}from"./trash-2-ExN6Amm1.js";import{A as ce}from"./alert-circle-D--r4mDh.js";import{a as F}from"./createLucideIcon-CJWRy_ZI.js";import{P as G,C as R}from"./phone-DHMtu4E5.js";import{R as _e}from"./refresh-cw-WJmzgc2f.js";import{E as q}from"./external-link-DzkkjUHP.js";/**
 * @license lucide-vue-next v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=F("CheckCircle2Icon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-vue-next v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=F("CopyIcon",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-vue-next v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=F("Settings2Icon",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]),xe={class:"flex flex-col h-full"},ke={class:"border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60"},ye={class:"flex h-16 items-center justify-between px-6"},be={class:"flex items-center gap-4"},he={key:0,class:"flex-1 flex items-center justify-center"},we={class:"p-6 space-y-4 max-w-4xl mx-auto"},Ce={class:"flex items-start gap-3"},Ae={class:"flex-1"},Ve={class:"flex items-center gap-2 mt-2"},$e={class:"flex items-start justify-between"},De={class:"flex items-start gap-4"},Ie={class:"h-12 w-12 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center flex-shrink-0"},Ue={class:"min-w-0"},Pe={class:"flex items-center gap-2 flex-wrap"},Me={class:"font-semibold text-lg"},Se={key:0,class:"mt-2"},Be={key:0,class:"flex items-center gap-2 text-green-600 dark:text-green-400"},Le={key:0,class:"text-sm text-muted-foreground"},We={key:1,class:"flex items-center gap-2 text-red-600 dark:text-red-400"},Te={class:"text-sm"},Re={class:"mt-3 grid grid-cols-2 gap-x-6 gap-y-1 text-sm"},ze={key:0,class:"flex items-center gap-2"},Fe={class:"text-xs bg-muted px-1 rounded"},Ne={class:"flex items-center gap-2"},je={class:"text-xs bg-muted px-1 rounded"},Ee={class:"flex items-center gap-2"},Ge={class:"text-xs bg-muted px-1 rounded"},qe={class:"flex items-center gap-2"},Oe={class:"flex items-center gap-2"},He={class:"mt-3 flex items-center gap-3 flex-wrap"},Ke={class:"mt-3 flex items-center gap-2 text-sm"},Xe={class:"text-xs bg-muted px-2 py-0.5 rounded font-mono truncate max-w-[200px]"},Je={class:"flex items-center gap-1"},Qe={class:"font-semibold flex items-center gap-2 mb-4"},Ye={class:"list-decimal list-inside space-y-3 text-sm text-muted-foreground"},Ze={href:"https://developers.facebook.com",target:"_blank",class:"text-primary hover:underline inline-flex items-center gap-1"},es={href:"https://business.facebook.com/settings/system-users",target:"_blank",class:"text-primary hover:underline inline-flex items-center gap-1"},ss={class:"space-y-4 py-4"},ts={class:"space-y-2"},os={class:"space-y-2"},as={class:"space-y-2"},ns={class:"space-y-2"},ls={class:"space-y-2"},is={key:0,class:"text-destructive"},rs={key:1,class:"text-muted-foreground"},ds={class:"space-y-2"},us={class:"space-y-2"},ps={class:"space-y-3"},fs={class:"flex items-center gap-2"},ms={class:"flex items-center gap-2"},cs={class:"flex items-center gap-2"},Ss=Q({__name:"AccountsView",setup(_s){const A=k([]),P=k(!0),w=k(!1),V=k(!1),g=k(null),$=k(null),b=k({}),r=k({name:"",app_id:"",phone_id:"",business_id:"",access_token:"",webhook_verify_token:"",api_version:"v21.0",is_default_incoming:!1,is_default_outgoing:!1,auto_read_receipt:!1});Y(async()=>{await M()});async function M(){var l;P.value=!0;try{const e=await C.get("/accounts");A.value=((l=e.data.data)==null?void 0:l.accounts)||[]}catch(e){console.error("Failed to fetch accounts:",e),f.error("Failed to load accounts"),A.value=[]}finally{P.value=!1}}function N(){g.value=null,r.value={name:"",app_id:"",phone_id:"",business_id:"",access_token:"",webhook_verify_token:"",api_version:"v21.0",is_default_incoming:!1,is_default_outgoing:!1,auto_read_receipt:!1},w.value=!0}function O(l){g.value=l,r.value={name:l.name,app_id:l.app_id||"",phone_id:l.phone_id,business_id:l.business_id,access_token:"",webhook_verify_token:l.webhook_verify_token,api_version:l.api_version,is_default_incoming:l.is_default_incoming,is_default_outgoing:l.is_default_outgoing,auto_read_receipt:l.auto_read_receipt},w.value=!0}async function H(){var l,e;if(!r.value.name.trim()||!r.value.phone_id.trim()||!r.value.business_id.trim()){f.error("Please fill in all required fields");return}if(!g.value&&!r.value.access_token.trim()){f.error("Access token is required for new accounts");return}V.value=!0;try{const u={...r.value};g.value&&!u.access_token&&delete u.access_token,g.value?(await C.put(`/accounts/${g.value.id}`,u),f.success("Account updated successfully")):(await C.post("/accounts",u),f.success("Account created successfully")),w.value=!1,await M()}catch(u){const a=((e=(l=u.response)==null?void 0:l.data)==null?void 0:e.message)||"Failed to save account";f.error(a)}finally{V.value=!1}}async function K(l){var e,u;if(confirm(`Are you sure you want to delete "${l.name}"? This action cannot be undone.`))try{await C.delete(`/accounts/${l.id}`),f.success("Account deleted"),await M()}catch(a){const v=((u=(e=a.response)==null?void 0:e.data)==null?void 0:u.message)||"Failed to delete account";f.error(v)}}async function X(l){var e,u;$.value=l.id;try{const a=await C.post(`/accounts/${l.id}/test`);b.value[l.id]=a.data.data,a.data.data.success?f.success("Connection successful!"):f.error("Connection failed: "+(a.data.data.error||"Unknown error"))}catch(a){const v=((u=(e=a.response)==null?void 0:e.data)==null?void 0:u.message)||"Connection test failed";b.value[l.id]={success:!1,error:v},f.error(v)}finally{$.value=null}}function S(l,e){navigator.clipboard.writeText(l),f.success(`${e} copied to clipboard`)}function J(l){switch(l){case"active":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300";case"inactive":return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300";case"error":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300";default:return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300"}}const j=window.location.origin+"/api/webhook";return(l,e)=>{const u=Z("RouterLink");return d(),_("div",xe,[s("header",ke,[s("div",ye,[s("div",be,[o(u,{to:"/settings"},{default:n(()=>[o(t(m),{variant:"ghost",size:"icon"},{default:n(()=>[o(t(pe),{class:"h-5 w-5"})]),_:1})]),_:1}),e[13]||(e[13]=s("div",null,[s("h1",{class:"text-xl font-semibold"},"WhatsApp Accounts"),s("p",{class:"text-sm text-muted-foreground"},"Manage your WhatsApp Business API connections")],-1))]),o(t(m),{onClick:N},{default:n(()=>[o(t(E),{class:"h-4 w-4 mr-2"}),e[14]||(e[14]=i(" Add Account ",-1))]),_:1})])]),P.value?(d(),_("div",he,[o(t(T),{class:"h-8 w-8 animate-spin text-muted-foreground"})])):(d(),x(t(oe),{key:1,class:"flex-1"},{default:n(()=>[s("div",we,[o(t(I),{class:"border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-950"},{default:n(()=>[o(t(D),{class:"p-4"},{default:n(()=>[s("div",Ce,[o(t(ce),{class:"h-5 w-5 text-blue-600 dark:text-blue-400 mt-0.5"}),s("div",Ae,[e[15]||(e[15]=s("h4",{class:"font-medium text-blue-900 dark:text-blue-100"},"Webhook Configuration",-1)),e[16]||(e[16]=s("p",{class:"text-sm text-blue-700 dark:text-blue-300 mt-1"}," Configure this URL in your Meta Developer Console as the webhook callback URL: ",-1)),s("div",Ve,[s("code",{class:"px-2 py-1 bg-blue-100 dark:bg-blue-900 rounded text-sm font-mono"},p(j)),o(t(m),{variant:"ghost",size:"sm",onClick:e[0]||(e[0]=a=>S(j,"Webhook URL"))},{default:n(()=>[o(t(z),{class:"h-4 w-4"})]),_:1})])])])]),_:1})]),_:1}),(d(!0),_(ee,null,se(A.value,a=>(d(),x(t(I),{key:a.id},{default:n(()=>[o(t(D),{class:"p-6"},{default:n(()=>[s("div",$e,[s("div",De,[s("div",Ie,[o(t(G),{class:"h-6 w-6 text-green-600 dark:text-green-400"})]),s("div",Ue,[s("div",Pe,[s("h3",Me,p(a.name),1),s("span",{class:te(["px-2 py-0.5 text-xs font-medium rounded-full",J(a.status)])},p(a.status),3)]),b.value[a.id]?(d(),_("div",Se,[b.value[a.id].success?(d(),_("div",Be,[o(t(ge),{class:"h-4 w-4"}),e[17]||(e[17]=s("span",{class:"text-sm font-medium"},"Connected",-1)),b.value[a.id].display_phone_number?(d(),_("span",Le," - "+p(b.value[a.id].display_phone_number),1)):y("",!0)])):(d(),_("div",We,[o(t(ne),{class:"h-4 w-4"}),s("span",Te,p(b.value[a.id].error),1)]))])):y("",!0),s("div",Re,[a.app_id?(d(),_("div",ze,[e[18]||(e[18]=s("span",{class:"text-muted-foreground"},"App ID:",-1)),s("code",Fe,p(a.app_id),1)])):y("",!0),s("div",Ne,[e[19]||(e[19]=s("span",{class:"text-muted-foreground"},"Phone ID:",-1)),s("code",je,p(a.phone_id),1),o(t(m),{variant:"ghost",size:"icon",class:"h-6 w-6",onClick:v=>S(a.phone_id,"Phone ID")},{default:n(()=>[o(t(z),{class:"h-3 w-3"})]),_:1},8,["onClick"])]),s("div",Ee,[e[20]||(e[20]=s("span",{class:"text-muted-foreground"},"Business ID:",-1)),s("code",Ge,p(a.business_id),1)]),s("div",qe,[e[21]||(e[21]=s("span",{class:"text-muted-foreground"},"API Version:",-1)),s("span",null,p(a.api_version),1)]),s("div",Oe,[e[22]||(e[22]=s("span",{class:"text-muted-foreground"},"Access Token:",-1)),o(t(U),{variant:a.has_access_token?"default":"destructive"},{default:n(()=>[i(p(a.has_access_token?"Configured":"Missing"),1)]),_:2},1032,["variant"])])]),s("div",He,[a.is_default_incoming?(d(),x(t(U),{key:0,variant:"outline"},{default:n(()=>[o(t(R),{class:"h-3 w-3 mr-1"}),e[23]||(e[23]=i(" Default Incoming ",-1))]),_:1})):y("",!0),a.is_default_outgoing?(d(),x(t(U),{key:1,variant:"outline"},{default:n(()=>[o(t(R),{class:"h-3 w-3 mr-1"}),e[24]||(e[24]=i(" Default Outgoing ",-1))]),_:1})):y("",!0),a.auto_read_receipt?(d(),x(t(U),{key:2,variant:"outline"},{default:n(()=>[o(t(R),{class:"h-3 w-3 mr-1"}),e[25]||(e[25]=i(" Auto Read Receipt ",-1))]),_:1})):y("",!0)]),s("div",Ke,[e[26]||(e[26]=s("span",{class:"text-muted-foreground"},"Verify Token:",-1)),s("code",Xe,p(a.webhook_verify_token),1),o(t(m),{variant:"ghost",size:"icon",class:"h-6 w-6",onClick:v=>S(a.webhook_verify_token,"Verify Token")},{default:n(()=>[o(t(z),{class:"h-3 w-3"})]),_:1},8,["onClick"])])])]),s("div",Je,[o(t(m),{variant:"ghost",size:"sm",onClick:v=>X(a),disabled:$.value===a.id},{default:n(()=>[$.value===a.id?(d(),x(t(T),{key:0,class:"h-4 w-4 animate-spin"})):(d(),x(t(_e),{key:1,class:"h-4 w-4"})),e[27]||(e[27]=s("span",{class:"ml-1"},"Test",-1))]),_:2},1032,["onClick","disabled"]),o(t(m),{variant:"ghost",size:"icon",onClick:v=>O(a)},{default:n(()=>[o(t(fe),{class:"h-4 w-4"})]),_:1},8,["onClick"]),o(t(m),{variant:"ghost",size:"icon",onClick:v=>K(a)},{default:n(()=>[o(t(me),{class:"h-4 w-4 text-destructive"})]),_:1},8,["onClick"])])])]),_:2},1024)]),_:2},1024))),128)),A.value.length===0?(d(),x(t(I),{key:0},{default:n(()=>[o(t(D),{class:"py-12 text-center text-muted-foreground"},{default:n(()=>[o(t(G),{class:"h-12 w-12 mx-auto mb-4 opacity-50"}),e[29]||(e[29]=s("p",{class:"text-lg font-medium"},"No WhatsApp accounts connected",-1)),e[30]||(e[30]=s("p",{class:"text-sm mb-4"},"Connect your WhatsApp Business account to start sending and receiving messages.",-1)),o(t(m),{onClick:N},{default:n(()=>[o(t(E),{class:"h-4 w-4 mr-2"}),e[28]||(e[28]=i(" Add Account ",-1))]),_:1})]),_:1})]),_:1})):y("",!0),o(t(I),null,{default:n(()=>[o(t(D),{class:"p-6"},{default:n(()=>[s("h3",Qe,[o(t(ve),{class:"h-5 w-5"}),e[31]||(e[31]=i(" Setup Guide ",-1))]),s("ol",Ye,[s("li",null,[e[33]||(e[33]=i(" Go to ",-1)),s("a",Ze,[e[32]||(e[32]=i(" Meta Developer Console ",-1)),o(t(q),{class:"h-3 w-3"})]),e[34]||(e[34]=i(" and create or select your app ",-1))]),e[37]||(e[37]=s("li",null,"Add WhatsApp product to your app and complete the setup",-1)),e[38]||(e[38]=s("li",null,[i("In WhatsApp > API Setup, copy your "),s("strong",null,"Phone Number ID"),i(" and "),s("strong",null,"WhatsApp Business Account ID")],-1)),s("li",null,[e[36]||(e[36]=i(" Create a permanent access token in ",-1)),s("a",es,[e[35]||(e[35]=i(" Business Settings > System Users ",-1)),o(t(q),{class:"h-3 w-3"})])]),e[39]||(e[39]=s("li",null,"Configure the webhook URL and verify token in your Meta app settings",-1)),e[40]||(e[40]=s("li",null,"Subscribe to messages webhook field",-1))])]),_:1})]),_:1})])]),_:1})),o(t(ae),{open:w.value,"onUpdate:open":e[12]||(e[12]=a=>w.value=a)},{default:n(()=>[o(t(le),{class:"max-w-lg max-h-[90vh] overflow-y-auto"},{default:n(()=>[o(t(ie),null,{default:n(()=>[o(t(re),null,{default:n(()=>[i(p(g.value?"Edit":"Add")+" WhatsApp Account",1)]),_:1}),o(t(de),null,{default:n(()=>[...e[41]||(e[41]=[i(" Connect your WhatsApp Business account using the Meta Cloud API. ",-1)])]),_:1})]),_:1}),s("div",ss,[s("div",ts,[o(t(c),{for:"name"},{default:n(()=>[...e[42]||(e[42]=[i("Account Name ",-1),s("span",{class:"text-destructive"},"*",-1)])]),_:1}),o(t(h),{id:"name",modelValue:r.value.name,"onUpdate:modelValue":e[1]||(e[1]=a=>r.value.name=a),placeholder:"e.g., Main Business Line"},null,8,["modelValue"])]),o(t(W)),s("div",os,[o(t(c),{for:"app_id"},{default:n(()=>[...e[43]||(e[43]=[i("Meta App ID",-1)])]),_:1}),o(t(h),{id:"app_id",modelValue:r.value.app_id,"onUpdate:modelValue":e[2]||(e[2]=a=>r.value.app_id=a),placeholder:"e.g., 123456789012345"},null,8,["modelValue"]),e[44]||(e[44]=s("p",{class:"text-xs text-muted-foreground"}," Found in Meta Developer Console > App Dashboard ",-1))]),s("div",as,[o(t(c),{for:"phone_id"},{default:n(()=>[...e[45]||(e[45]=[i("Phone Number ID ",-1),s("span",{class:"text-destructive"},"*",-1)])]),_:1}),o(t(h),{id:"phone_id",modelValue:r.value.phone_id,"onUpdate:modelValue":e[3]||(e[3]=a=>r.value.phone_id=a),placeholder:"e.g., 123456789012345"},null,8,["modelValue"]),e[46]||(e[46]=s("p",{class:"text-xs text-muted-foreground"}," Found in Meta Developer Console > WhatsApp > API Setup ",-1))]),s("div",ns,[o(t(c),{for:"business_id"},{default:n(()=>[...e[47]||(e[47]=[i("WhatsApp Business Account ID ",-1),s("span",{class:"text-destructive"},"*",-1)])]),_:1}),o(t(h),{id:"business_id",modelValue:r.value.business_id,"onUpdate:modelValue":e[4]||(e[4]=a=>r.value.business_id=a),placeholder:"e.g., 987654321098765"},null,8,["modelValue"])]),s("div",ls,[o(t(c),{for:"access_token"},{default:n(()=>[e[48]||(e[48]=i(" Access Token ",-1)),g.value?(d(),_("span",rs,"(leave blank to keep existing)")):(d(),_("span",is,"*"))]),_:1}),o(t(h),{id:"access_token",modelValue:r.value.access_token,"onUpdate:modelValue":e[5]||(e[5]=a=>r.value.access_token=a),type:"password",placeholder:"Permanent access token from System User"},null,8,["modelValue"]),e[49]||(e[49]=s("p",{class:"text-xs text-muted-foreground"}," Generate in Business Settings > System Users > Generate Token ",-1))]),o(t(W)),s("div",ds,[o(t(c),{for:"api_version"},{default:n(()=>[...e[50]||(e[50]=[i("API Version",-1)])]),_:1}),o(t(h),{id:"api_version",modelValue:r.value.api_version,"onUpdate:modelValue":e[6]||(e[6]=a=>r.value.api_version=a),placeholder:"v21.0"},null,8,["modelValue"])]),s("div",us,[o(t(c),{for:"webhook_verify_token"},{default:n(()=>[...e[51]||(e[51]=[i("Webhook Verify Token",-1)])]),_:1}),o(t(h),{id:"webhook_verify_token",modelValue:r.value.webhook_verify_token,"onUpdate:modelValue":e[7]||(e[7]=a=>r.value.webhook_verify_token=a),placeholder:"Auto-generated if empty"},null,8,["modelValue"]),e[52]||(e[52]=s("p",{class:"text-xs text-muted-foreground"}," Used to verify webhook requests from Meta ",-1))]),o(t(W)),s("div",ps,[o(t(c),null,{default:n(()=>[...e[53]||(e[53]=[i("Options",-1)])]),_:1}),s("div",fs,[B(s("input",{type:"checkbox",id:"is_default_incoming","onUpdate:modelValue":e[8]||(e[8]=a=>r.value.is_default_incoming=a),class:"rounded border-gray-300"},null,512),[[L,r.value.is_default_incoming]]),o(t(c),{for:"is_default_incoming",class:"font-normal cursor-pointer"},{default:n(()=>[...e[54]||(e[54]=[i(" Default for incoming messages ",-1)])]),_:1})]),s("div",ms,[B(s("input",{type:"checkbox",id:"is_default_outgoing","onUpdate:modelValue":e[9]||(e[9]=a=>r.value.is_default_outgoing=a),class:"rounded border-gray-300"},null,512),[[L,r.value.is_default_outgoing]]),o(t(c),{for:"is_default_outgoing",class:"font-normal cursor-pointer"},{default:n(()=>[...e[55]||(e[55]=[i(" Default for outgoing messages ",-1)])]),_:1})]),s("div",cs,[B(s("input",{type:"checkbox",id:"auto_read_receipt","onUpdate:modelValue":e[10]||(e[10]=a=>r.value.auto_read_receipt=a),class:"rounded border-gray-300"},null,512),[[L,r.value.auto_read_receipt]]),o(t(c),{for:"auto_read_receipt",class:"font-normal cursor-pointer"},{default:n(()=>[...e[56]||(e[56]=[i(" Automatically send read receipts ",-1)])]),_:1})])])]),o(t(ue),null,{default:n(()=>[o(t(m),{variant:"outline",onClick:e[11]||(e[11]=a=>w.value=!1)},{default:n(()=>[...e[57]||(e[57]=[i("Cancel",-1)])]),_:1}),o(t(m),{onClick:H,disabled:V.value},{default:n(()=>[V.value?(d(),x(t(T),{key:0,class:"h-4 w-4 mr-2 animate-spin"})):y("",!0),i(" "+p(g.value?"Update":"Create")+" Account ",1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])])}}});export{Ss as default};
