import{z as X,r as p,p as A,A as K,B as U,d as Z,f as ee,x as te,C as se,D as ae,E as N,c as g,h as n,a as l,b as t,w as u,F as B,v as m,j as E,G as ne,l as F,s as R,i as P,e as oe,o as _,n as S,k as Q,t as re,K as ce}from"./index-CYNh7eqI.js";import{_ as C}from"./Button.vue_vue_type_script_setup_true_lang-CdpToHaS.js";import{_ as ie}from"./Input.vue_vue_type_script_setup_true_lang-c8YZDCZO.js";import{_ as le}from"./Textarea.vue_vue_type_script_setup_true_lang-qPA_yzOk.js";import{_ as q,a as G,b as H}from"./AvatarFallback.vue_vue_type_script_setup_true_lang-DvI59oIm.js";import{_ as ue}from"./Badge.vue_vue_type_script_setup_true_lang-lXziiQoX.js";import{_ as Y}from"./ScrollArea.vue_vue_type_script_setup_true_lang-BYu-HJVo.js";import{a as D,g as J}from"./createLucideIcon-CJWRy_ZI.js";import{S as de}from"./search-C4qlZP-j.js";import{S as O}from"./send-BPuayp4C.js";import{P as fe,C as me}from"./phone-DHMtu4E5.js";import{V as _e}from"./video-BEctA8Cc.js";import{C as pe}from"./clock-ClXEs7uf.js";import{A as he}from"./alert-circle-D--r4mDh.js";import{C as W}from"./check-check-mfYiyYzL.js";/**
 * @license lucide-vue-next v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=D("MoreVerticalIcon",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-vue-next v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=D("PaperclipIcon",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-vue-next v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=D("SmileIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);/**
 * @license lucide-vue-next v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=D("UserIcon",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),we=X("contacts",()=>{const v=p([]),b=p(null),d=p([]),o=p(!1),f=p(!1),y=p(""),x=A(()=>{if(!y.value)return v.value;const a=y.value.toLowerCase();return v.value.filter(i=>{var r;return i.name.toLowerCase().includes(a)||i.phone_number.includes(a)||((r=i.profile_name)==null?void 0:r.toLowerCase().includes(a))})}),w=A(()=>[...x.value].sort((a,i)=>{const r=a.last_message_at?new Date(a.last_message_at).getTime():0;return(i.last_message_at?new Date(i.last_message_at).getTime():0)-r}));async function k(a){o.value=!0;try{const i=await K.list(a),r=i.data.data||i.data;v.value=r.contacts||[]}catch(i){console.error("Failed to fetch contacts:",i)}finally{o.value=!1}}async function j(a){try{const i=await K.get(a),r=i.data.data||i.data;return b.value=r,r}catch(i){return console.error("Failed to fetch contact:",i),null}}async function M(a,i){f.value=!0;try{const r=await U.list(a,i),e=r.data.data||r.data;d.value=e.messages||[]}catch(r){console.error("Failed to fetch messages:",r)}finally{f.value=!1}}async function V(a,i,r){try{const e=await U.send(a,{type:i,content:r}),c=e.data.data||e.data;d.value.push(c);const s=v.value.find(h=>h.id===a);return s&&(s.last_message_at=c.created_at),c}catch(e){throw console.error("Failed to send message:",e),e}}async function L(a,i,r){try{const c=(await U.sendTemplate(a,{template_name:i,components:r})).data;return d.value.push(c),c}catch(e){throw console.error("Failed to send template:",e),e}}function T(a){if(!d.value.some(r=>r.id===a.id)){d.value.push(a);const r=v.value.find(e=>e.id===a.contact_id);r&&(r.last_message_at=a.created_at,a.direction==="incoming"&&r.unread_count++)}}function I(a,i){const r=d.value.find(e=>e.id===a);r&&(r.status=i)}function $(a){b.value=a,a&&(a.unread_count=0)}function z(){d.value=[]}return{contacts:v,currentContact:b,messages:d,isLoading:o,isLoadingMessages:f,searchQuery:y,filteredContacts:x,sortedContacts:w,fetchContacts:k,fetchContact:j,fetchMessages:M,sendMessage:V,sendTemplate:L,addMessage:T,updateMessageStatus:I,setCurrentContact:$,clearMessages:z}}),Ce={class:"flex h-full"},be={class:"w-80 border-r flex flex-col bg-card"},ke={class:"p-4 border-b"},Me={class:"relative"},Se={class:"py-2"},Ve=["onClick"],Te={class:"flex-1 min-w-0"},Ie={class:"flex items-center justify-between"},De={class:"font-medium truncate"},je={class:"text-xs text-muted-foreground"},Le={class:"flex items-center justify-between mt-0.5"},$e={class:"text-sm text-muted-foreground truncate"},ze={key:0,class:"p-4 text-center text-muted-foreground"},Ue={class:"flex-1 flex flex-col"},Be={key:0,class:"flex-1 flex items-center justify-center text-muted-foreground"},Fe={class:"text-center"},Pe={class:"h-16 w-16 rounded-full bg-muted flex items-center justify-center mx-auto mb-4"},Ae={class:"h-16 px-4 border-b flex items-center justify-between bg-card"},Ke={class:"flex items-center gap-3"},Ne={class:"font-medium"},Ee={class:"text-xs text-muted-foreground"},Re={class:"flex items-center gap-2"},Qe={class:"space-y-4"},qe={class:"whitespace-pre-wrap break-words"},Ge={class:"p-4 border-t bg-card"},He={class:"flex gap-1"},ut=Z({__name:"ChatView",setup(v){const b=ee(),d=oe(),o=we(),f=p(""),y=p(null),x=p(!1),w=p(null),k=A(()=>b.params.contactId);function j(){M(),w.value=window.setInterval(async()=>{o.currentContact&&await o.fetchMessages(o.currentContact.id)},3e3)}function M(){w.value&&(clearInterval(w.value),w.value=null)}te(async()=>{await o.fetchContacts(),k.value&&await V(k.value)}),se(()=>{M()}),ae(k,async e=>{e?await V(e):(M(),o.setCurrentContact(null),o.clearMessages())});async function V(e){const c=o.contacts.find(s=>s.id===e);c&&(o.setCurrentContact(c),await o.fetchMessages(e),I(),j())}function L(e){d.push(`/chat/${e.id}`)}async function T(){if(!(!f.value.trim()||!o.currentContact)){x.value=!0;try{await o.sendMessage(o.currentContact.id,"text",{body:f.value}),f.value="",await N(),I()}catch{ce.error("Failed to send message")}finally{x.value=!1}}}function I(){N(()=>{y.value&&y.value.scrollIntoView({behavior:"smooth"})})}function $(e){switch(e){case"sent":return me;case"delivered":return W;case"read":return W;case"failed":return he;default:return pe}}function z(e){switch(e){case"read":return"text-blue-500";case"failed":return"text-destructive";default:return"text-muted-foreground"}}function a(e){return new Date(e).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}function i(e){if(!e)return"";const c=new Date(e),h=Math.floor((new Date().getTime()-c.getTime())/864e5);return h===0?c.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):h===1?"Yesterday":h<7?c.toLocaleDateString("en-US",{weekday:"short"}):c.toLocaleDateString("en-US",{month:"short",day:"numeric"})}function r(e){var c;return e.message_type==="text"?((c=e.content)==null?void 0:c.body)||"":e.message_type==="image"?"[Image]":e.message_type==="document"?"[Document]":e.message_type==="template"?"[Template Message]":"[Message]"}return(e,c)=>(_(),g("div",Ce,[n("div",be,[n("div",ke,[n("div",Me,[l(t(de),{class:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),l(t(ie),{modelValue:t(o).searchQuery,"onUpdate:modelValue":c[0]||(c[0]=s=>t(o).searchQuery=s),placeholder:"Search contacts...",class:"pl-9"},null,8,["modelValue"])])]),l(t(Y),{class:"flex-1"},{default:u(()=>[n("div",Se,[(_(!0),g(B,null,R(t(o).sortedContacts,s=>{var h;return _(),g("div",{key:s.id,class:S(["flex items-center gap-3 px-4 py-3 cursor-pointer hover:bg-accent transition-colors",((h=t(o).currentContact)==null?void 0:h.id)===s.id&&"bg-accent"]),onClick:Ye=>L(s)},[l(t(q),{class:"h-12 w-12"},{default:u(()=>[l(t(G),{src:s.avatar_url},null,8,["src"]),l(t(H),null,{default:u(()=>[P(m(t(J)(s.name||s.phone_number)),1)]),_:2},1024)]),_:2},1024),n("div",Te,[n("div",Ie,[n("p",De,m(s.name||s.phone_number),1),n("span",je,m(i(s.last_message_at)),1)]),n("div",Le,[n("p",$e,m(s.profile_name||s.phone_number),1),s.unread_count>0?(_(),Q(t(ue),{key:0,class:"ml-2"},{default:u(()=>[P(m(s.unread_count),1)]),_:2},1024)):F("",!0)])])],10,Ve)}),128)),t(o).sortedContacts.length===0?(_(),g("div",ze,[l(t(xe),{class:"h-8 w-8 mx-auto mb-2 opacity-50"}),c[2]||(c[2]=n("p",null,"No contacts found",-1))])):F("",!0)])]),_:1})]),n("div",Ue,[t(o).currentContact?(_(),g(B,{key:1},[n("div",Ae,[n("div",Ke,[l(t(q),{class:"h-10 w-10"},{default:u(()=>[l(t(G),{src:t(o).currentContact.avatar_url},null,8,["src"]),l(t(H),null,{default:u(()=>[P(m(t(J)(t(o).currentContact.name||t(o).currentContact.phone_number)),1)]),_:1})]),_:1}),n("div",null,[n("p",Ne,m(t(o).currentContact.name||t(o).currentContact.phone_number),1),n("p",Ee,m(t(o).currentContact.phone_number),1)])]),n("div",Re,[l(t(C),{variant:"ghost",size:"icon"},{default:u(()=>[l(t(fe),{class:"h-5 w-5"})]),_:1}),l(t(C),{variant:"ghost",size:"icon"},{default:u(()=>[l(t(_e),{class:"h-5 w-5"})]),_:1}),l(t(C),{variant:"ghost",size:"icon"},{default:u(()=>[l(t(ge),{class:"h-5 w-5"})]),_:1})])]),l(t(Y),{class:"flex-1 p-4"},{default:u(()=>[n("div",Qe,[(_(!0),g(B,null,R(t(o).messages,s=>(_(),g("div",{key:s.id,class:S(["flex",s.direction==="outgoing"?"justify-end":"justify-start"])},[n("div",{class:S(["chat-bubble",s.direction==="outgoing"?"chat-bubble-outgoing":"chat-bubble-incoming"])},[n("p",qe,m(r(s)),1),n("div",{class:S(["chat-bubble-time flex items-center gap-1",s.direction==="outgoing"?"justify-end":"justify-start"])},[n("span",null,m(a(s.created_at)),1),s.direction==="outgoing"?(_(),Q(re($(s.status)),{key:0,class:S(["h-3 w-3",z(s.status)])},null,8,["class"])):F("",!0)],2)],2)],2))),128)),n("div",{ref_key:"messagesEndRef",ref:y},null,512)])]),_:1}),n("div",Ge,[n("form",{onSubmit:E(T,["prevent"]),class:"flex items-end gap-2"},[n("div",He,[l(t(C),{type:"button",variant:"ghost",size:"icon"},{default:u(()=>[l(t(ye),{class:"h-5 w-5"})]),_:1}),l(t(C),{type:"button",variant:"ghost",size:"icon"},{default:u(()=>[l(t(ve),{class:"h-5 w-5"})]),_:1})]),l(t(le),{modelValue:f.value,"onUpdate:modelValue":c[1]||(c[1]=s=>f.value=s),placeholder:"Type a message...",class:"flex-1 min-h-[40px] max-h-[120px] resize-none",rows:1,onKeydown:ne(E(T,["exact","prevent"]),["enter"])},null,8,["modelValue","onKeydown"]),l(t(C),{type:"submit",size:"icon",disabled:!f.value.trim()||x.value},{default:u(()=>[l(t(O),{class:"h-5 w-5"})]),_:1},8,["disabled"])],32)])],64)):(_(),g("div",Be,[n("div",Fe,[n("div",Pe,[l(t(O),{class:"h-8 w-8"})]),c[3]||(c[3]=n("h3",{class:"font-medium text-lg mb-1"},"Select a conversation",-1)),c[4]||(c[4]=n("p",{class:"text-sm"},"Choose a contact to start chatting",-1))])]))])]))}});export{ut as default};
